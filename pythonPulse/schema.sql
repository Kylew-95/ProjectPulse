-- Run this in the Supabase SQL Editor

-- 1. Create Messages Table
create table messages (
  id bigint generated by default as identity primary key,
  user_id text not null,
  username text,
  channel_id text not null,
  content text,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- 2. Create Knowledge Base Table
create table knowledge_base (
  id bigint generated by default as identity primary key,
  question text not null,
  answer text not null,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- 3. Enable Row Level Security (RLS) - Optional for internal tools but good practice
alter table messages enable row level security;
alter table knowledge_base enable row level security;

-- Policy: Allow anonymous setup (connection via API key) to insert/select
create policy "Allow Anon Insert Messages" on messages for insert with check (true);
create policy "Allow Anon Select Messages" on messages for select using (true);
create policy "Allow Anon All KB" on knowledge_base for all using (true);
